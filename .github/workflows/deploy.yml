name: Deploy

on: #ãƒˆãƒªã‚¬ãƒ¼ã‚’è¨­å®š
  #ä¸‹è¨˜ãƒ–ãƒ©ãƒ³ãƒã«pushã•ã‚ŒãŸã‚‰å®Ÿè¡Œ
  push:
    branches: ["master", "main"]

  #ä¸‹è¨˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã‚‰å®Ÿè¡Œ
  repository_dispatch:
    types: [update_post]

jobs: #å®Ÿè¡Œã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’æŒ‡å®šã™ã‚‹
  build: #ã€Œbuildã€ã¨ã„ã†åå‰ã®ã‚¸ãƒ§ãƒ–ã‚’å®šç¾©
    name: ğŸ‰ Deploy
    #Ubuntuã®æœ€æ–°ç‰ˆç’°å¢ƒå†…ã§å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æŒ‡å®š
    runs-on: ubuntu-latest

    #å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚„ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã™ã‚‹
    steps:
      #å…¬å¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€Œactions/checkoutã€å®Ÿè¡Œã™ã‚‹ã€‚ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã‚‹
      - name: ğŸ“¦ Get latest code
        uses: actions/checkout@v3

      #nodeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
      - name: ğŸ’» Setup node
        uses: actions/setup-node@v3 #å…¬å¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹
        with: #å¼•æ•°ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
          node-version: "18"

      #ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      - name: âš¡ Cache node modules
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      #node moduleã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: ğŸ˜‰ Install modules
        run: npm install
        working-directory: ./ #ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒˆãƒƒãƒ—ã§å®Ÿè¡Œ

      # #ãƒ“ãƒ«ãƒ‰
      - name: ğŸ¶ Build Project
        run: npm run build
        working-directory: ./ #ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒˆãƒƒãƒ—ã§å®Ÿè¡Œ
        env: #ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
          API_KEY: ${{ secrets.API_KEY }} #APIã®URLã‚’è¨­å®š
          SERVICE_DOMAIN: ${{ secrets.SERVICE_DOMAIN }} #ã‚µãƒ¼ãƒ“ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®š
          NEXT_PUBLIC_API_KEY: ${{ secrets.NEXT_PUBLIC_API_KEY }} #ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®APIã®URLã‚’è¨­å®š
          NEXT_PUBLIC_SERVICE_DOMAIN: ${{ secrets.NEXT_PUBLIC_SERVICE_DOMAIN }} #ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®š
          NEXT_PUBLIC_SITE_URL: ${{ secrets.NEXT_PUBLIC_SITE_URL }} #ã‚µã‚¤ãƒˆURLã‚’è¨­å®š
          NEXT_PUBLIC_GA_ID: ${{ secrets.NEXT_PUBLIC_GA_ID }} #Google Analyticsã®IDã‚’è¨­å®š
          NEXT_PUBLIC_ZENN: ${{ secrets.NEXT_PUBLIC_ZENN }} #Zennã®URLã‚’è¨­å®š
          NEXT_PUBLIC_GOOGLE_ADSENSE_PUBLISHER_ID: ${{ secrets.NEXT_PUBLIC_GOOGLE_ADSENSE_PUBLISHER_ID }} #Google AdSenseã®ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ£ãƒ¼IDã‚’è¨­å®š

      # #ãƒ“ãƒ«ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’FTPã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - name: ğŸ  Upload to FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.FTP_SERVER }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼å
          username: ${{ secrets.FTP_ACCOUNT }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå
          password: ${{ secrets.FTP_PASSWORD }} #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ã‚µãƒ¼ãƒãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
          local-dir: out/ #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®éšå±¤ã‚’æŒ‡å®š
          server-dir: /hsmkrt-tech/ #ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š
